<div id="content"></div>
<script type="text/jsx">

    var friends = [];
    {% for d in data %}
        var row = {};
        row['char_id'] = "{{ d.char_id }}";

        var friend_list = [];
        {% for k, v in d.friends.items %}
            var friend = {};
            friend['char_id'] = "{{ k }}";
            friend['status'] = "{{ v }}";
            friend_list.push(friend);
        {% endfor %}
        row['friends'] = friend_list;

        friends.push(row);
    {% endfor %}

    var counter = 0;
    var Row = React.createClass({
        render: function () {
            var friendRows = '';
            var tmp = 0;
            this.props.row.friends.forEach(function (friend) {
                if(tmp % 2 != 0){
                    friendRows += ';   ';
                }
                friendRows += {friend}.friend.char_id + ': ' + {friend}.friend.status;
                tmp++;
            }.bind(this));

            var name = '';
            if(counter % 2 === 0){
                name = 'alt';
            }
            counter++;

            return (
                    <tr className={name}>
                        <td>{this.props.row.char_id}</td>
                        <td>{friendRows}</td>
                    </tr>
            );
        }
    });

    var FriendsTable = React.createClass({
        render: function () {
            var rows = [];
            this.props.friends.forEach(function (row) {
                if (row.char_id.indexOf(this.props.filterText) === -1) {
                    return;
                }

                rows.push(<Row row={row}/>);
            }.bind(this));
            return (
                    <table className="pure-table-my">
                        <thead>
                            <tr>
                                <th>Char_ID</th>
                                <th>Friends</th>
                            </tr>
                        </thead>
                        <tbody>{rows}</tbody>
                    </table>
            );
        }
    });

    var SearchBar = React.createClass({

        handleChange: function () {
            this.props.onUserInput(
                    this.refs.filterTextInput.getDOMNode().value
            );
        },

        render: function () {
            return (
                    <from>
                        <input
                                type="text"
                                placeholder="Search...ID"
                                value={this.props.filterText}
                                ref="filterTextInput"
                                onChange={this.handleChange}
                                />
                    </from>
            );
        }
    });

    var FriendForm = React.createClass({

        getInitialState: function () {
            return {
                filterText: ''
            };
        },

        handleUserInput: function (filterText) {
            this.setState({
                filterText: filterText
            });
        },

        render: function () {
            return (
                    <div>
                        <div className="header">
                            <h1>Friend</h1>
                        </div>
                        <div className="searchBar">
                            <SearchBar
                                    filterText={this.state.filterText}
                                    onUserInput={this.handleUserInput}
                                    />
                        </div>
                        <div className="middle">
                            <FriendsTable
                                    friends={this.props.friends}
                                    filterText={this.state.filterText}
                                    />
                        </div>
                    </div>
            );
        }
    });

    React.render(
            <FriendForm friends={friends}/>,
            document.getElementById('content')
    )
</script>
